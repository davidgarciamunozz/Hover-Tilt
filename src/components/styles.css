:root {
    /* Card aura/glow effect colors */
    --card-edge: hsl(47, 100%, 78%);
    --card-glow: hsl(175, 100%, 90%);
}

main {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    display: grid;
    place-content: center;
    min-height: 90svh;
    overflow: hidden;
    gap: 2rem;
}

.card {
    display: grid;
    place-content: center;
    min-height: 600px;
    min-width: 400px;
}

input {
    margin-top: 1rem;
    appearance: none;
    color: rgb(41, 47, 61);
    background: hsl(222, 20%, 100%);
    padding: 0.875em;
    border-radius: 0.5rem;
    border: 1px solid transparent;
    outline: 1px solid transparent;
    accent-color: hsl(200, 85%, 60%);
    box-shadow: 0 3px 2px -3px hsl(222, 20%, 85%);
    transition: border 0.3s ease-in, outline 0.6s ease-in,
        box-shadow 0.6s ease-in;
}

input:focus {
    border-color: hsl(160, 85%, 60%);
    outline-color: hsl(200, 85%, 60%);
    transition: border 0.6s ease-out, outline 0.3s ease-out,
        box-shadow 0.3s ease-out;
}

.stacked-3d::part(tilt) {
    /* by default, the will-change list is: transform, box-shadow, opacity */
    will-change: transform, box-shadow, mask;
    /* we remove the 'opacity' property from the will-change list, because when 'opacity'
      is set; the 3d context becomes "flat" and will not allow parallax effects. */
}

.stacked-3d::part(container) {
    /* Ensure the container matches the content height exactly */
    height: fit-content;
    padding: 0;
    margin: 0;
}

.stacked-3d::part(tilt)::before {
    z-index: 1;
    /* make sure the glare is on top of the background image */
}

.stacked-3d-content {
    --depth: 60px;
    /* an arbitrary depth value */
    --layer-z: max(var(--hover-tilt-opacity) * var(--depth), 0px);
    /* max is used so the layers dont go behind the background */
    --shadow-opacity: calc(var(--hover-tilt-opacity) * 0.4);
    /* shadow is hidden when the layer is not active */
    --shadow-size: calc(var(--depth) / 5);
    /* shadow size is 1/5 of the depth */
    --shadow-offset: calc(var(--depth) / 8);
    /* shadow offset is 1/8 of the depth */
    --shadow-offset-x: calc(var(--shadow-x) * var(--shadow-offset));
    --shadow-offset-y: calc(var(--shadow-y) * var(--shadow-offset));

    /* this is essential for the 3d effect to work */
    transform-style: preserve-3d;
    position: relative;
    /* Let the container size itself based on the images, matching other cards */
    display: inline-block;
    /* Ensure no extra spacing that could affect parent height */
    margin: 0;
    padding: 0;
    line-height: 0;
    vertical-align: top;
}

.stacked-3d-bg {
    /* background stays at the base layer and determines container size */
    position: relative;
    z-index: 1;
    display: block;
}

.stacked-3d-logo {
    /* pop the logo and image to the front of the container */
    --scale-factor: calc(1 + (var(--hover-tilt-opacity) * 0.05));
    /* scale up to 25% larger on hover for more noticeable pop effect */
    transform: translateZ(var(--layer-z)) scale(var(--scale-factor));
    /* apply a dynamic drop shadow to the logo and image */
    filter: drop-shadow(var(--shadow-offset-x) var(--shadow-offset-y) var(--shadow-size) rgba(0, 0, 0, var(--shadow-opacity)));
    /* ensure it appears above the background */
    position: absolute;
    top: 0;
    left: 2px;
    /* slight offset to the right */
    z-index: 2;
    width: 100%;
    height: 100%;
    object-fit: contain;
    /* performance consideration */
    will-change: transform, filter;
}

/* Card flip container */
.card-flip-container {
    position: relative;
    perspective: 600px;
    transform-style: preserve-3d;
    cursor: pointer;
    will-change: transform;
    transition: transform 0.8s cubic-bezier(0.22, 0.61, 0.36, 1);
}

/* Active card - centered and scaled using transform only */
.card-flip-container.active {
    z-index: 1000;
    /* Transform is applied inline via JavaScript */
    transition: transform 0.8s cubic-bezier(0.22, 0.61, 0.36, 1);
}

/* The wrapper that actually rotates */
.card-flip-wrapper {
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.8s cubic-bezier(0.22, 0.61, 0.36, 1);
    transform: rotateY(var(--card-rotate-y, 0deg));
}

/* First flip does 360 degrees */
.card-flip-container.first-flip .card-flip-wrapper {
    transition: transform 1.2s cubic-bezier(0.22, 0.61, 0.36, 1);
}

/* Individual card faces */
.card-face {
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    transform-style: preserve-3d;
}

.card-face.back {
    transform: rotateY(180deg) translateZ(1px);
    position: absolute;
    top: 0;
    left: 0;
}

/* Aura glow effect */
hover-tilt.card-aura::part(tilt) {
    transition: box-shadow 0.4s ease;
    border-radius: 0;
    box-shadow:
        0 0 3px -1px transparent,
        0 0 2px 1px transparent,
        0 0 5px 0px transparent,
        0px 10px 20px -5px black,
        0 2px 15px -5px black,
        0 0 20px 0px transparent;
}

hover-tilt.card-aura:hover::part(tilt),
hover-tilt.card-aura.active::part(tilt) {
    box-shadow:
        0 0 3px -1px white,
        0 0 3px 1px var(--card-edge),
        0 0 12px 2px var(--card-glow),
        0px 10px 20px -5px black,
        0 0 40px -30px var(--card-glow),
        0 0 50px -20px var(--card-glow);
}

/* Hidden state for flipped cards */
hover-tilt.hidden {
    display: none;
}

/* Responsive layout tweaks */
@media (max-width: 768px) {
    hover-tilt img {
        max-width: 100%;
        height: auto;
    }

    .stacked-3d-content {
        width: 100%;
    }
}

/* VStar Foil Effect */

.vstar-card {
    /* Container class - variables moved to content to access slotted values */
}

.vstar-card::part(tilt) {
    border-radius: 4.55% / 3.5% !important;
}

.vstar-card-content {
    /* Define sunpillar colors */
    --sunpillar-1: hsl(2, 100%, 73%);
    --sunpillar-2: hsl(53, 100%, 69%);
    --sunpillar-3: hsl(93, 100%, 69%);
    --sunpillar-4: hsl(176, 100%, 76%);
    --sunpillar-5: hsl(228, 100%, 74%);
    --sunpillar-6: hsl(283, 100%, 73%);

    --sunpillar-clr-1: var(--sunpillar-1);
    --sunpillar-clr-2: var(--sunpillar-2);
    --sunpillar-clr-3: var(--sunpillar-3);
    --sunpillar-clr-4: var(--sunpillar-4);
    --sunpillar-clr-5: var(--sunpillar-5);
    --sunpillar-clr-6: var(--sunpillar-6);

    /* Map hover-tilt variables */
    /* These are available here because this element is the slotted content */
    --pointer-x: var(--gradient-x);
    --pointer-y: var(--gradient-y);
    --card-opacity: var(--hover-tilt-opacity);

    /* Calculate background position similar to pokemon-cards-css */
    /* adjust(percent.x, 0, 100, 37, 63) => 37% + percent * 0.26 */
    --background-x: calc(37% + (var(--hover-tilt-x) * 26%));
    --background-y: calc(33% + (var(--hover-tilt-y) * 34%));

    /* Pointer from center - using opacity as a proxy for intensity/activation */
    --pointer-from-center: var(--hover-tilt-opacity);

    /* Images */
    --mask: url(/cards/pokemon/charizard-foil-2.webp);
    --foil: url(/cards/pokemon/charizard-foil-1.webp);

    display: grid;
    grid-template-areas: "card";
    position: relative;
    border-radius: inherit;
    overflow: hidden;
    width: 100%;
    height: 100%;
    transform: translateZ(0);
    /* Fix for Safari/stacking context */
}

.vstar-card-content>* {
    grid-area: card;
    border-radius: inherit;
}

.vstar-card-content .card__front-img {
    z-index: 1;
    position: relative;
}

.card__shine,
.card__glare {
    pointer-events: none;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 2;
    width: 100%;
    height: 100%;
}

/* Masking */
.vstar-card-content .card__shine,
.vstar-card-content .card__shine::before,
.vstar-card-content .card__shine::after {
    -webkit-mask-image:
        var(--mask),
        radial-gradient(farthest-corner circle at var(--pointer-x) var(--pointer-y),
            hsla(0, 0%, 100%, 0) 0%,
            hsla(0, 0%, 100%, .5) 120%);
    mask-image:
        var(--mask),
        radial-gradient(farthest-corner circle at var(--pointer-x) var(--pointer-y),
            hsla(0, 0%, 100%, 0) 0%,
            hsla(0, 0%, 100%, .5) 120%);
    -webkit-mask-size: 100% 100%;
    mask-size: 100% 100%;
    -webkit-mask-position: center center;
    mask-position: center center;
}

/* Shine Layers */
.vstar-card-content .card__shine,
.vstar-card-content .card__shine:after {
    --space: 5%;
    --angle: 133deg;
    --imgsize: cover;

    background-image:
        var(--foil),
        repeating-linear-gradient(0deg,
            var(--sunpillar-clr-1) calc(var(--space)*1),
            var(--sunpillar-clr-2) calc(var(--space)*2),
            var(--sunpillar-clr-3) calc(var(--space)*3),
            var(--sunpillar-clr-4) calc(var(--space)*4),
            var(--sunpillar-clr-5) calc(var(--space)*5),
            var(--sunpillar-clr-6) calc(var(--space)*6),
            var(--sunpillar-clr-1) calc(var(--space)*7)),
        repeating-linear-gradient(var(--angle),
            #0e152e 0%,
            hsl(180, 10%, 60%) 3.8%,
            hsl(180, 29%, 66%) 4.5%,
            hsl(180, 10%, 60%) 5.2%,
            #0e152e 10%,
            #0e152e 12%),
        radial-gradient(farthest-corner circle at var(--pointer-x) var(--pointer-y),
            hsla(0, 0%, 0%, 0.1) 12%,
            hsla(0, 0%, 0%, 0.15) 20%,
            hsla(0, 0%, 0%, 0.25) 120%);

    background-blend-mode: soft-light, hue, hard-light;
    background-size: var(--imgsize), 200% 700%, 300% 100%, 200% 100%;
    background-position: center center, 0% var(--background-y), var(--background-x) var(--background-y), var(--background-x) var(--background-y);

    filter: brightness(calc((var(--pointer-from-center) * .75) + .25)) contrast(2) saturate(1.25);
    mix-blend-mode: color-dodge;
    opacity: var(--card-opacity);
}

.vstar-card-content .card__shine:after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;

    background-size: var(--imgsize), 200% 400%, 195% 100%, 200% 100%;
    background-position: center center, 0% var(--background-y), calc(var(--background-x) * -1) calc(var(--background-y) * -1), var(--background-x) var(--background-y);

    filter: brightness(calc((var(--pointer-from-center) * .75) + .5)) contrast(1.5) saturate(4);
    mix-blend-mode: exclusion;
}

.vstar-card-content .card__shine::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;

    background-image: radial-gradient(farthest-corner circle at var(--pointer-x) var(--pointer-y), hsla(190, 7%, 80%, 0.75) 0%, hsla(260, 7%, 50%, 0.25) 45%, hsl(310, 7%, 50%) 120%);
    mix-blend-mode: hard-light;
    z-index: 2;
    opacity: 0.8;
}

/* Glare Layers */
.vstar-card-content .card__glare {
    filter: brightness(.7) contrast(2);

    background-image:
        radial-gradient(farthest-corner circle at var(--pointer-x) var(--pointer-y),
            hsl(195, 90%, 90%) 5%,
            hsl(300, 3%, 60%) 60%,
            hsl(350, 0%, 15%) 150%);

    mix-blend-mode: hard-light;
    opacity: calc(var(--card-opacity)*(var(--pointer-from-center)*.75));
}